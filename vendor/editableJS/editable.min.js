window.rangy=function(){function e(e,t){var n=typeof e[t];return n==d||!(n!=u||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=u||!e[t])}function n(e,t){return typeof e[t]!=l}function o(e){return function(t,n){for(var o=n.length;o--;)if(!e(t,n[o]))return!1;return!0}}function r(e){return e&&v(e,m)&&R(e,p)}function i(e){window.alert("Rangy not supported in your browser. Reason: "+e),N.initialized=!0,N.supported=!1}function s(e){var t="Rangy warning: "+e;N.config.alertOnWarn?window.alert(t):typeof window.console!=l&&typeof window.console.log!=l&&window.console.log(t)}function a(){if(!N.initialized){var n,o=!1,s=!1;e(document,"createRange")&&(n=document.createRange(),v(n,g)&&R(n,h)&&(o=!0),n.detach());var a=t(document,"body")?document.body:document.getElementsByTagName("body")[0];a&&e(a,"createTextRange")&&(n=a.createTextRange(),r(n)&&(s=!0)),o||s||i("Neither Range nor TextRange are implemented"),N.initialized=!0,N.features={implementsDomRange:o,implementsTextRange:s};for(var c=y.concat(E),f=0,u=c.length;u>f;++f)try{c[f](N)}catch(d){t(window,"console")&&e(window.console,"log")&&window.console.log("Init listener threw an exception. Continuing.",d)}}}function c(e){e=e||window,a();for(var t=0,n=w.length;n>t;++t)w[t](e)}function f(e){this.name=e,this.initialized=!1,this.supported=!1}var u="object",d="function",l="undefined",h=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"],g=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],p=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],m=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"],v=o(e),C=o(t),R=o(n),N={version:"1.2.3",initialized:!1,supported:!0,util:{isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:v,areHostObjects:C,areHostProperties:R,isTextRange:r},features:{},modules:{},config:{alertOnWarn:!1,preferTextRange:!1}};N.fail=i,N.warn=s,{}.hasOwnProperty?N.util.extend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}:i("hasOwnProperty not supported");var E=[],y=[];N.init=a,N.addInitListener=function(e){N.initialized?e(N):E.push(e)};var w=[];N.addCreateMissingNativeApiListener=function(e){w.push(e)},N.createMissingNativeApi=c,f.prototype.fail=function(e){throw this.initialized=!0,this.supported=!1,Error("Module '"+this.name+"' failed to load: "+e)},f.prototype.warn=function(e){N.warn("Module "+this.name+": "+e)},f.prototype.createError=function(e){return Error("Error in Rangy "+this.name+" module: "+e)},N.createModule=function(e,t){var n=new f(e);N.modules[e]=n,y.push(function(e){t(e,n),n.initialized=!0,n.supported=!0})},N.requireModules=function(e){for(var t,n,o=0,r=e.length;r>o;++o){if(n=e[o],t=N.modules[n],!(t&&t instanceof f))throw Error("Module '"+n+"' not found");if(!t.supported)throw Error("Module '"+n+"' not supported")}};var S=!1,O=function(){S||(S=!0,N.initialized||a())};return typeof window==l?(i("No window found"),void 0):typeof document==l?(i("No document found"),void 0):(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",O,!1),e(window,"addEventListener")?window.addEventListener("load",O,!1):e(window,"attachEvent")?window.attachEvent("onload",O):i("Window does not have required addEventListener or attachEvent method"),N)}(),rangy.createModule("DomUtil",function(e,t){function n(e){var t;return typeof e.namespaceURI==O||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function o(e){var t=e.parentNode;return 1==t.nodeType?t:null}function r(e){for(var t=0;e=e.previousSibling;)t++;return t}function i(e){var t;return f(e)?e.length:(t=e.childNodes)?t.length:0}function s(e,t){var n,o=[];for(n=e;n;n=n.parentNode)o.push(n);for(n=t;n;n=n.parentNode)if(b(o,n))return n;return null}function a(e,t,n){for(var o=n?t:t.parentNode;o;){if(o===e)return!0;o=o.parentNode}return!1}function c(e,t,n){for(var o,r=n?e:e.parentNode;r;){if(o=r.parentNode,o===t)return r;r=o}return null}function f(e){var t=e.nodeType;return 3==t||4==t||8==t}function u(e,t){var n=t.nextSibling,o=t.parentNode;return n?o.insertBefore(e,n):o.appendChild(e),e}function d(e,t){var n=e.cloneNode(!1);return n.deleteData(0,t),e.deleteData(t,e.length-t),u(n,e),n}function l(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=O)return e.ownerDocument;if(typeof e.document!=O)return e.document;if(e.parentNode)return l(e.parentNode);throw Error("getDocument: no document found for node")}function h(e){var t=l(e);if(typeof t.defaultView!=O)return t.defaultView;if(typeof t.parentWindow!=O)return t.parentWindow;throw Error("Cannot get a window object for node")}function g(e){if(typeof e.contentDocument!=O)return e.contentDocument;if(typeof e.contentWindow!=O)return e.contentWindow.document;throw Error("getIframeWindow: No Document object found for iframe element")}function p(e){if(typeof e.contentWindow!=O)return e.contentWindow;if(typeof e.contentDocument!=O)return e.contentDocument.defaultView;throw Error("getIframeWindow: No Window object found for iframe element")}function m(e){return _.isHostObject(e,"body")?e.body:e.getElementsByTagName("body")[0]}function v(e){for(var t;t=e.parentNode;)e=t;return e}function C(e,t,n,o){var i,a,f,u,d;if(e==n)return t===o?0:o>t?-1:1;if(i=c(n,e,!0))return r(i)>=t?-1:1;if(i=c(e,n,!0))return o>r(i)?-1:1;if(a=s(e,n),f=e===a?a:c(e,a,!0),u=n===a?a:c(n,a,!0),f===u)throw Error("comparePoints got to case 4 and childA and childB are the same!");for(d=a.firstChild;d;){if(d===f)return-1;if(d===u)return 1;d=d.nextSibling}throw Error("Should not be here!")}function R(e){for(var t,n=l(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function N(e){if(!e)return"[No node]";if(f(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">["+e.childNodes.length+"]"}return e.nodeName}function E(e){this.root=e,this._next=e}function y(e){return new E(e)}function w(e,t){this.node=e,this.offset=t}function S(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var O="undefined",_=e.util;_.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),_.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var T=document.createElement("div");_.areHostMethods(T,["insertBefore","appendChild","cloneNode"]||!_.areHostObjects(T,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),_.isHostProperty(T,"innerHTML")||t.fail("Element is missing innerHTML property");var D=document.createTextNode("test");_.areHostMethods(D,["splitText","deleteData","insertData","appendData","cloneNode"]||!_.areHostObjects(T,["previousSibling","nextSibling","childNodes","parentNode"])||!_.areHostProperties(D,["data"]))||t.fail("Incomplete Text Node implementation");var b=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1};E.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},w.prototype={equals:function(e){return this.node===e.node&this.offset==e.offset},inspect:function(){return"[DomPosition("+N(this.node)+":"+this.offset+")]"}},S.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11},S.prototype.toString=function(){return this.message},e.dom={arrayContains:b,isHtmlNamespace:n,parentElement:o,getNodeIndex:r,getNodeLength:i,getCommonAncestor:s,isAncestorOf:a,getClosestAncestorIn:c,isCharacterDataNode:f,insertAfter:u,splitDataNode:d,getDocument:l,getWindow:h,getIframeWindow:p,getIframeDocument:g,getBody:m,getRootContainer:v,comparePoints:C,inspectNode:N,fragmentFromNodeChildren:R,createIterator:y,DomPosition:w},e.DOMException=S}),rangy.createModule("DomRange",function(e){function t(e,t){return 3!=e.nodeType&&(L.isAncestorOf(e,t.startContainer,!0)||L.isAncestorOf(e,t.endContainer,!0))}function n(e){return L.getDocument(e.startContainer)}function o(e,t,n){var o=e._listeners[t];if(o)for(var r=0,i=o.length;i>r;++r)o[r].call(e,{target:e,args:n})}function r(e){return new k(e.parentNode,L.getNodeIndex(e))}function i(e){return new k(e.parentNode,L.getNodeIndex(e)+1)}function s(e,t,n){var o=11==e.nodeType?e.firstChild:e;return L.isCharacterDataNode(t)?n==t.length?L.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:L.splitDataNode(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),o}function a(e){for(var t,o,r,i=n(e.range).createDocumentFragment();o=e.next();){if(t=e.isPartiallySelectedSubtree(),o=o.cloneNode(!t),t&&(r=e.getSubtreeIterator(),o.appendChild(a(r)),r.detach(!0)),10==o.nodeType)throw new W("HIERARCHY_REQUEST_ERR");i.appendChild(o)}return i}function c(e,t,n){var o,r;n=n||{stop:!1};for(var i,s;i=e.next();)if(e.isPartiallySelectedSubtree()){if(t(i)===!1)return n.stop=!0,void 0;if(s=e.getSubtreeIterator(),c(s,t,n),s.detach(!0),n.stop)return}else for(o=L.createIterator(i);r=o.next();)if(t(r)===!1)return n.stop=!0,void 0}function f(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),f(t),t.detach(!0)):e.remove()}function u(e){for(var t,o,r=n(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),o=e.getSubtreeIterator(),t.appendChild(u(o)),o.detach(!0)):e.remove(),10==t.nodeType)throw new W("HIERARCHY_REQUEST_ERR");r.appendChild(t)}return r}function d(e,t,n){var o,r=!(!t||!t.length),i=!!n;r&&(o=RegExp("^("+t.join("|")+")$"));var s=[];return c(new h(e,!1),function(e){r&&!o.test(e.nodeType)||i&&!n(e)||s.push(e)}),s}function l(e){var t=e.getName===void 0?"Range":e.getName();return"["+t+"("+L.inspectNode(e.startContainer)+":"+e.startOffset+", "+L.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function h(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&L.isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||L.isCharacterDataNode(this.sc)?L.getClosestAncestorIn(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||L.isCharacterDataNode(this.ec)?L.getClosestAncestorIn(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function g(e){this.code=this[e],this.codeName=e,this.message="RangeException: "+this.codeName}function p(e,t,n){this.nodes=d(e,t,n),this._next=this.nodes[0],this._position=0}function m(e){return function(t,n){for(var o,r=n?t:t.parentNode;r;){if(o=r.nodeType,L.arrayContains(e,o))return r;r=r.parentNode}return null}}function v(e,t){if(G(e,t))throw new g("INVALID_NODE_TYPE_ERR")}function C(e){if(!e.startContainer)throw new W("INVALID_STATE_ERR")}function R(e,t){if(!L.arrayContains(t,e.nodeType))throw new g("INVALID_NODE_TYPE_ERR")}function N(e,t){if(0>t||t>(L.isCharacterDataNode(e)?e.length:e.childNodes.length))throw new W("INDEX_SIZE_ERR")}function E(e,t){if(Y(e,!0)!==Y(t,!0))throw new W("WRONG_DOCUMENT_ERR")}function y(e){if(Q(e,!0))throw new W("NO_MODIFICATION_ALLOWED_ERR")}function w(e,t){if(!e)throw new W(t)}function S(e){return!L.arrayContains(j,e.nodeType)&&!Y(e,!0)}function O(e,t){return(L.isCharacterDataNode(e)?e.length:e.childNodes.length)>=t}function _(e){return!!e.startContainer&&!!e.endContainer&&!S(e.startContainer)&&!S(e.endContainer)&&O(e.startContainer,e.startOffset)&&O(e.endContainer,e.endOffset)}function T(e){if(C(e),!_(e))throw Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}function D(){}function b(e){e.START_TO_START=et,e.START_TO_END=tt,e.END_TO_END=nt,e.END_TO_START=ot,e.NODE_BEFORE=rt,e.NODE_AFTER=it,e.NODE_BEFORE_AND_AFTER=st,e.NODE_INSIDE=at}function A(e){b(e),b(e.prototype)}function x(e,t){return function(){T(this);var n,o,r=this.startContainer,s=this.startOffset,a=this.commonAncestorContainer,f=new h(this,!0);r!==a&&(n=L.getClosestAncestorIn(r,a,!0),o=i(n),r=o.node,s=o.offset),c(f,y),f.reset();var u=e(f);return f.detach(),t(this,r,s,r,s),u}}function I(n,o,s){function a(e,t){return function(n){C(this),R(n,F),R(z(n),j);var o=(e?r:i)(n);(t?c:d)(this,o.node,o.offset)}}function c(e,t,n){var r=e.endContainer,i=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((z(t)!=z(r)||1==L.comparePoints(t,n,r,i))&&(r=t,i=n),o(e,t,n,r,i))}function d(e,t,n){var r=e.startContainer,i=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((z(t)!=z(r)||-1==L.comparePoints(t,n,r,i))&&(r=t,i=n),o(e,r,i,t,n))}function l(e,t,n){(t!==e.startContainer||n!==e.startOffset||t!==e.endContainer||n!==e.endOffset)&&o(e,t,n,t,n)}n.prototype=new D,e.util.extend(n.prototype,{setStart:function(e,t){C(this),v(e,!0),N(e,t),c(this,e,t)},setEnd:function(e,t){C(this),v(e,!0),N(e,t),d(this,e,t)},setStartBefore:a(!0,!0),setStartAfter:a(!1,!0),setEndBefore:a(!0,!1),setEndAfter:a(!1,!1),collapse:function(e){T(this),e?o(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):o(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){C(this),v(e,!0),o(this,e,0,e,L.getNodeLength(e))},selectNode:function(e){C(this),v(e,!1),R(e,F);var t=r(e),n=i(e);o(this,t.node,t.offset,n.node,n.offset)},extractContents:x(u,o),deleteContents:x(f,o),canSurroundContents:function(){T(this),y(this.startContainer),y(this.endContainer);var e=new h(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},detach:function(){s(this)},splitBoundaries:function(){T(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,r=this.endOffset,i=e===n;L.isCharacterDataNode(n)&&r>0&&n.length>r&&L.splitDataNode(n,r),L.isCharacterDataNode(e)&&t>0&&e.length>t&&(e=L.splitDataNode(e,t),i?(r-=t,n=e):n==e.parentNode&&r>=L.getNodeIndex(e)&&r++,t=0),o(this,e,t,n,r)},normalizeBoundaries:function(){T(this);var e=this.startContainer,t=this.startOffset,n=this.endContainer,r=this.endOffset,i=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(n=e,r=e.length,e.appendData(t.data),t.parentNode.removeChild(t))},s=function(o){var i=o.previousSibling;if(i&&i.nodeType==o.nodeType){e=o;var s=o.length;if(t=i.length,o.insertData(0,i.data),i.parentNode.removeChild(i),e==n)r+=t,n=e;else if(n==o.parentNode){var a=L.getNodeIndex(o);r==a?(n=o,r=s):r>a&&r--}}},a=!0;if(L.isCharacterDataNode(n))n.length==r&&i(n);else{if(r>0){var c=n.childNodes[r-1];c&&L.isCharacterDataNode(c)&&i(c)}a=!this.collapsed}if(a){if(L.isCharacterDataNode(e))0==t&&s(e);else if(e.childNodes.length>t){var f=e.childNodes[t];f&&L.isCharacterDataNode(f)&&s(f)}}else e=n,t=r;o(this,e,t,n,r)},collapseToPoint:function(e,t){C(this),v(e,!0),N(e,t),l(this,e,t)}}),A(n)}function P(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:L.getCommonAncestor(e.startContainer,e.endContainer)}function H(e,t,n,r,i){var s=e.startContainer!==t||e.startOffset!==n,a=e.endContainer!==r||e.endOffset!==i;e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=i,P(e),o(e,"boundarychange",{startMoved:s,endMoved:a})}function B(e){C(e),e.startContainer=e.startOffset=e.endContainer=e.endOffset=null,e.collapsed=e.commonAncestorContainer=null,o(e,"detach",null),e._listeners=null}function M(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this._listeners={boundarychange:[],detach:[]},P(this)}e.requireModules(["DomUtil"]);var L=e.dom,k=L.DomPosition,W=e.DOMException;h.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,L.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!L.isCharacterDataNode(n)||n!==this.sc&&n!==this.ec?n.parentNode&&n.parentNode.removeChild(n):(e=n===this.sc?this.so:0,t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return t(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse();else{e=new M(n(this.range));var t=this._current,o=t,r=0,i=t,s=L.getNodeLength(t);L.isAncestorOf(t,this.sc,!0)&&(o=this.sc,r=this.so),L.isAncestorOf(t,this.ec,!0)&&(i=this.ec,s=this.eo),H(e,o,r,i,s)}return new h(e,this.clonePartiallySelectedTextNodes)},detach:function(e){e&&this.range.detach(),this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},g.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2},g.prototype.toString=function(){return this.message},p.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){return this._current=this._next,this._next=this.nodes[++this._position],this._current},detach:function(){this._current=this._next=this.nodes=null}};var F=[1,3,4,5,7,8,10],j=[2,9,11],U=[5,6,10,12],V=[1,3,4,5,7,8,10,11],q=[1,3,4,5,7,8],z=L.getRootContainer,Y=m([9,11]),Q=m(U),G=m([6,10,12]),K=document.createElement("style"),X=!1;try{K.innerHTML="<b>x</b>",X=3==K.firstChild.nodeType}catch(Z){}e.features.htmlParsingConforms=X;var $=X?function(e){var t=this.startContainer,n=L.getDocument(t);if(!t)throw new W("INVALID_STATE_ERR");var o=null;return 1==t.nodeType?o=t:L.isCharacterDataNode(t)&&(o=L.parentElement(t)),o=null===o||"HTML"==o.nodeName&&L.isHtmlNamespace(L.getDocument(o).documentElement)&&L.isHtmlNamespace(o)?n.createElement("body"):o.cloneNode(!1),o.innerHTML=e,L.fragmentFromNodeChildren(o)}:function(e){C(this);var t=n(this),o=t.createElement("body");return o.innerHTML=e,L.fragmentFromNodeChildren(o)},J=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],et=0,tt=1,nt=2,ot=3,rt=0,it=1,st=2,at=3;D.prototype={attachListener:function(e,t){this._listeners[e].push(t)},compareBoundaryPoints:function(e,t){T(this),E(this.startContainer,t.startContainer);var n,o,r,i,s=e==ot||e==et?"start":"end",a=e==tt||e==et?"start":"end";return n=this[s+"Container"],o=this[s+"Offset"],r=t[a+"Container"],i=t[a+"Offset"],L.comparePoints(n,o,r,i)},insertNode:function(e){if(T(this),R(e,V),y(this.startContainer),L.isAncestorOf(e,this.startContainer,!0))throw new W("HIERARCHY_REQUEST_ERR");var t=s(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){T(this);var e,t;if(this.collapsed)return n(this).createDocumentFragment();if(this.startContainer===this.endContainer&&L.isCharacterDataNode(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=n(this).createDocumentFragment(),t.appendChild(e),t;var o=new h(this,!0);return e=a(o),o.detach(),e},canSurroundContents:function(){T(this),y(this.startContainer),y(this.endContainer);var e=new h(this,!0),n=e._first&&t(e._first,this)||e._last&&t(e._last,this);return e.detach(),!n},surroundContents:function(e){if(R(e,q),!this.canSurroundContents())throw new g("BAD_BOUNDARYPOINTS_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);s(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){T(this);for(var e,t=new M(n(this)),o=J.length;o--;)e=J[o],t[e]=this[e];return t},toString:function(){T(this);var e=this.startContainer;if(e===this.endContainer&&L.isCharacterDataNode(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new h(this,!0);return c(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){T(this);var t=e.parentNode,n=L.getNodeIndex(e);if(!t)throw new W("NOT_FOUND_ERR");var o=this.comparePoint(t,n),r=this.comparePoint(t,n+1);return 0>o?r>0?st:rt:r>0?it:at},comparePoint:function(e,t){return T(this),w(e,"HIERARCHY_REQUEST_ERR"),E(e,this.startContainer),0>L.comparePoints(e,t,this.startContainer,this.startOffset)?-1:L.comparePoints(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:$,toHtml:function(){T(this);var e=n(this).createElement("div");return e.appendChild(this.cloneContents()),e.innerHTML},intersectsNode:function(e,t){if(T(this),w(e,"NOT_FOUND_ERR"),L.getDocument(e)!==n(this))return!1;var o=e.parentNode,r=L.getNodeIndex(e);w(o,"NOT_FOUND_ERR");var i=L.comparePoints(o,r,this.endContainer,this.endOffset),s=L.comparePoints(o,r+1,this.startContainer,this.startOffset);return t?0>=i&&s>=0:0>i&&s>0},isPointInRange:function(e,t){return T(this),w(e,"HIERARCHY_REQUEST_ERR"),E(e,this.startContainer),L.comparePoints(e,t,this.startContainer,this.startOffset)>=0&&0>=L.comparePoints(e,t,this.endContainer,this.endOffset)},intersectsRange:function(e,t){if(T(this),n(e)!=n(this))throw new W("WRONG_DOCUMENT_ERR");var o=L.comparePoints(this.startContainer,this.startOffset,e.endContainer,e.endOffset),r=L.comparePoints(this.endContainer,this.endOffset,e.startContainer,e.startOffset);return t?0>=o&&r>=0:0>o&&r>0},intersection:function(e){if(this.intersectsRange(e)){var t=L.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=L.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset),o=this.cloneRange();return-1==t&&o.setStart(e.startContainer,e.startOffset),1==n&&o.setEnd(e.endContainer,e.endOffset),o}return null},union:function(e){if(this.intersectsRange(e,!0)){var t=this.cloneRange();return-1==L.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==L.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new g("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==at},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&0>=this.comparePoint(e,L.getNodeLength(e))},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var o=n.pop();t.setEnd(o,o.length);var r=this.containsRange(t);return t.detach(),r}return this.containsNodeContents(e)},createNodeIterator:function(e,t){return T(this),new p(this,e,t)},getNodes:function(e,t){return T(this),d(this,e,t)},getDocument:function(){return n(this)},collapseBefore:function(e){C(this),this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){C(this),this.setStartAfter(e),this.collapse(!0)},getName:function(){return"DomRange"},equals:function(e){return M.rangesEqual(this,e)},isValid:function(){return _(this)},inspect:function(){return l(this)}},I(M,H,B),e.rangePrototype=D.prototype,M.rangeProperties=J,M.RangeIterator=h,M.copyComparisonConstants=A,M.createPrototypeRange=I,M.inspect=l,M.getRangeDocument=n,M.rangesEqual=function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset},e.DomRange=M,e.RangeException=g}),rangy.createModule("WrappedRange",function(e){function t(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var o=n.parentElement();n=e.duplicate(),n.collapse(!1);var r=n.parentElement(),i=o==r?o:s.getCommonAncestor(o,r);return i==t?i:s.getCommonAncestor(t,i)}function n(e){return 0==e.compareEndPoints("StartToEnd",e)}function o(e,t,n,o){var r=e.duplicate();r.collapse(n);var i=r.parentElement();if(s.isAncestorOf(t,i,!0)||(i=t),!i.canHaveHTML)return new a(i.parentNode,s.getNodeIndex(i));var c,f,u,d,l,h=s.getDocument(i).createElement("span"),g=n?"StartToStart":"StartToEnd";do i.insertBefore(h,h.previousSibling),r.moveToElementText(h);while((c=r.compareEndPoints(g,e))>0&&h.previousSibling);if(l=h.nextSibling,-1==c&&l&&s.isCharacterDataNode(l)){r.setEndPoint(n?"EndToStart":"EndToEnd",e);var p;if(/[\r\n]/.test(l.data)){var m=r.duplicate(),v=m.text.replace(/\r\n/g,"\r").length;for(p=m.moveStart("character",v);-1==(c=m.compareEndPoints("StartToEnd",m));)p++,m.moveStart("character",1)}else p=r.text.length;d=new a(l,p)}else f=(o||!n)&&h.previousSibling,u=(o||n)&&h.nextSibling,d=u&&s.isCharacterDataNode(u)?new a(u,0):f&&s.isCharacterDataNode(f)?new a(f,f.length):new a(i,s.getNodeIndex(h));return h.parentNode.removeChild(h),d}function r(e,t){var n,o,r,i,a=e.offset,c=s.getDocument(e.node),f=c.body.createTextRange(),u=s.isCharacterDataNode(e.node);return u?(n=e.node,o=n.parentNode):(i=e.node.childNodes,n=i.length>a?i[a]:null,o=e.node),r=c.createElement("span"),r.innerHTML="&#feff;",n?o.insertBefore(r,n):o.appendChild(r),f.moveToElementText(r),f.collapse(!t),o.removeChild(r),u&&f[t?"moveStart":"moveEnd"]("character",a),f}e.requireModules(["DomUtil","DomRange"]);var i,s=e.dom,a=s.DomPosition,c=e.DomRange;if(!e.features.implementsDomRange||e.features.implementsTextRange&&e.config.preferTextRange){if(e.features.implementsTextRange){i=function(e){this.textRange=e,this.refresh()},i.prototype=new c(document),i.prototype.refresh=function(){var e,r,i=t(this.textRange);n(this.textRange)?r=e=o(this.textRange,i,!0,!0):(e=o(this.textRange,i,!0,!1),r=o(this.textRange,i,!1,!1)),this.setStart(e.node,e.offset),this.setEnd(r.node,r.offset)},c.copyComparisonConstants(i);var f=function(){return this}();f.Range===void 0&&(f.Range=i),e.createNativeRange=function(e){return e=e||document,e.body.createTextRange()}}}else(function(){function t(e){for(var t,n=u.length;n--;)t=u[n],e[t]=e.nativeRange[t]}function n(e,t,n,o,r){var i=e.startContainer!==t||e.startOffset!=n,s=e.endContainer!==o||e.endOffset!=r;(i||s)&&(e.setEnd(o,r),e.setStart(t,n))}function o(e){e.nativeRange.detach(),e.detached=!0;for(var t,n=u.length;n--;)t=u[n],e[t]=null}var r,a,f,u=c.rangeProperties;i=function(e){if(!e)throw Error("Range must be specified");this.nativeRange=e,t(this)},c.createPrototypeRange(i,n,o),r=i.prototype,r.selectNode=function(e){this.nativeRange.selectNode(e),t(this)},r.deleteContents=function(){this.nativeRange.deleteContents(),t(this)},r.extractContents=function(){var e=this.nativeRange.extractContents();return t(this),e},r.cloneContents=function(){return this.nativeRange.cloneContents()},r.surroundContents=function(e){this.nativeRange.surroundContents(e),t(this)},r.collapse=function(e){this.nativeRange.collapse(e),t(this)},r.cloneRange=function(){return new i(this.nativeRange.cloneRange())},r.refresh=function(){t(this)},r.toString=function(){return""+this.nativeRange};var d=document.createTextNode("test");s.getBody(document).appendChild(d);var l=document.createRange();l.setStart(d,0),l.setEnd(d,0);try{l.setStart(d,1),a=!0,r.setStart=function(e,n){this.nativeRange.setStart(e,n),t(this)},r.setEnd=function(e,n){this.nativeRange.setEnd(e,n),t(this)},f=function(e){return function(n){this.nativeRange[e](n),t(this)}}}catch(h){a=!1,r.setStart=function(e,n){try{this.nativeRange.setStart(e,n)}catch(o){this.nativeRange.setEnd(e,n),this.nativeRange.setStart(e,n)}t(this)},r.setEnd=function(e,n){try{this.nativeRange.setEnd(e,n)}catch(o){this.nativeRange.setStart(e,n),this.nativeRange.setEnd(e,n)}t(this)},f=function(e,n){return function(o){try{this.nativeRange[e](o)}catch(r){this.nativeRange[n](o),this.nativeRange[e](o)}t(this)}}}r.setStartBefore=f("setStartBefore","setEndBefore"),r.setStartAfter=f("setStartAfter","setEndAfter"),r.setEndBefore=f("setEndBefore","setStartBefore"),r.setEndAfter=f("setEndAfter","setStartAfter"),l.selectNodeContents(d),r.selectNodeContents=l.startContainer==d&&l.endContainer==d&&0==l.startOffset&&l.endOffset==d.length?function(e){this.nativeRange.selectNodeContents(e),t(this)}:function(e){this.setStart(e,0),this.setEnd(e,c.getEndOffset(e))},l.selectNodeContents(d),l.setEnd(d,3);var g=document.createRange();g.selectNodeContents(d),g.setEnd(d,4),g.setStart(d,2),r.compareBoundaryPoints=-1==l.compareBoundaryPoints(l.START_TO_END,g)&1==l.compareBoundaryPoints(l.END_TO_START,g)?function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)},e.util.isHostMethod(l,"createContextualFragment")&&(r.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),s.getBody(document).removeChild(d),l.detach(),g.detach()})(),e.createNativeRange=function(e){return e=e||document,e.createRange()};e.features.implementsTextRange&&(i.rangeToTextRange=function(e){if(e.collapsed){var t=r(new a(e.startContainer,e.startOffset),!0);return t}var n=r(new a(e.startContainer,e.startOffset),!0),o=r(new a(e.endContainer,e.endOffset),!1),i=s.getDocument(e.startContainer).body.createTextRange();return i.setEndPoint("StartToStart",n),i.setEndPoint("EndToEnd",o),i}),i.prototype.getName=function(){return"WrappedRange"},e.WrappedRange=i,e.createRange=function(t){return t=t||document,new i(e.createNativeRange(t))},e.createRangyRange=function(e){return e=e||document,new c(e)},e.createIframeRange=function(t){return e.createRange(s.getIframeDocument(t))},e.createIframeRangyRange=function(t){return e.createRangyRange(s.getIframeDocument(t))},e.addCreateMissingNativeApiListener(function(t){var n=t.document;n.createRange===void 0&&(n.createRange=function(){return e.createRange(this)}),n=t=null})}),rangy.createModule("WrappedSelection",function(e,t){function n(e){return(e||window).getSelection()}function o(e){return(e||window).document.selection}function r(e,t,n){var o=n?"end":"start",r=n?"start":"end";e.anchorNode=t[o+"Container"],e.anchorOffset=t[o+"Offset"],e.focusNode=t[r+"Container"],e.focusOffset=t[r+"Offset"]}function i(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function s(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function a(t){var n;return t instanceof S?(n=t._selectionNativeRange,n||(n=e.createNativeRange(y.getDocument(t.startContainer)),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset),t._selectionNativeRange=n,t.attachListener("detach",function(){this._selectionNativeRange=null}))):t instanceof O?n=t.nativeRange:e.features.implementsDomRange&&t instanceof y.getWindow(t.startContainer).Range&&(n=t),n}function c(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!y.isAncestorOf(e[0],e[t]))return!1;return!0}function f(e){var t=e.getNodes();if(!c(t))throw Error("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return t[0]}function u(e){return!!e&&e.text!==void 0}function d(e,t){var n=new O(t);e._ranges=[n],r(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function l(t){if(t._ranges.length=0,"None"==t.docSelection.type)s(t);else{var n=t.docSelection.createRange();if(u(n))d(t,n);else{t.rangeCount=n.length;for(var o,i=y.getDocument(n.item(0)),a=0;t.rangeCount>a;++a)o=e.createRange(i),o.selectNode(n.item(a)),t._ranges.push(o);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,r(t,t._ranges[t.rangeCount-1],!1)
}}}function h(e,t){for(var n=e.docSelection.createRange(),o=f(t),r=y.getDocument(n.item(0)),i=y.getBody(r).createControlRange(),s=0,a=n.length;a>s;++s)i.add(n.item(s));try{i.add(o)}catch(c){throw Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}i.select(),l(e)}function g(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function p(e,t){for(var n,o=y.getDocument(t[0].startContainer),r=y.getBody(o).createControlRange(),i=0;rangeCount>i;++i){n=f(t[i]);try{r.add(n)}catch(s){throw Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}r.select(),l(e)}function m(e,t){if(e.anchorNode&&y.getDocument(e.anchorNode)!==y.getDocument(t))throw new _("WRONG_DOCUMENT_ERR")}function v(e){var t=[],n=new T(e.anchorNode,e.anchorOffset),o=new T(e.focusNode,e.focusOffset),r="function"==typeof e.getName?e.getName():"Selection";if(e.rangeCount!==void 0)for(var i=0,s=e.rangeCount;s>i;++i)t[i]=S.inspect(e.getRangeAt(i));return"["+r+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+o.inspect()+"]"}e.requireModules(["DomUtil","DomRange","WrappedRange"]),e.config.checkSelectionRanges=!0;var C,R,N="boolean",E="_rangySelection",y=e.dom,w=e.util,S=e.DomRange,O=e.WrappedRange,_=e.DOMException,T=y.DomPosition,D="Control",b=e.util.isHostMethod(window,"getSelection"),A=e.util.isHostObject(document,"selection"),x=A&&(!b||e.config.preferTextRange);x?(C=o,e.isSelectionValid=function(e){var t=(e||window).document,n=t.selection;return"None"!=n.type||y.getDocument(n.createRange().parentElement())==t}):b?(C=n,e.isSelectionValid=function(){return!0}):t.fail("Neither document.selection or window.getSelection() detected."),e.getNativeSelection=C;var I=C(),P=e.createNativeRange(document),H=y.getBody(document),B=w.areHostObjects(I,["anchorNode","focusNode"]&&w.areHostProperties(I,["anchorOffset","focusOffset"]));e.features.selectionHasAnchorAndFocus=B;var M=w.isHostMethod(I,"extend");e.features.selectionHasExtend=M;var L="number"==typeof I.rangeCount;e.features.selectionHasRangeCount=L;var k=!1,W=!0;w.areHostMethods(I,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof I.rangeCount&&e.features.implementsDomRange&&function(){var e=document.createElement("iframe");e.frameBorder=0,e.style.position="absolute",e.style.left="-10000px",H.appendChild(e);var t=y.getIframeDocument(e);t.open(),t.write("<html><head></head><body>12</body></html>"),t.close();var n=y.getIframeWindow(e).getSelection(),o=t.documentElement,r=o.lastChild,i=r.firstChild,s=t.createRange();s.setStart(i,1),s.collapse(!0),n.addRange(s),W=1==n.rangeCount,n.removeAllRanges();var a=s.cloneRange();s.setStart(i,0),a.setEnd(i,2),n.addRange(s),n.addRange(a),k=2==n.rangeCount,s.detach(),a.detach(),H.removeChild(e)}(),e.features.selectionSupportsMultipleRanges=k,e.features.collapsedNonEditableSelectionsSupported=W;var F,j=!1;H&&w.isHostMethod(H,"createControlRange")&&(F=H.createControlRange(),w.areHostProperties(F,["item","add"])&&(j=!0)),e.features.implementsControlRange=j,R=B?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var U;w.isHostMethod(I,"getRangeAt")?U=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:B&&(U=function(t){var n=y.getDocument(t.anchorNode),o=e.createRange(n);return o.setStart(t.anchorNode,t.anchorOffset),o.setEnd(t.focusNode,t.focusOffset),o.collapsed!==this.isCollapsed&&(o.setStart(t.focusNode,t.focusOffset),o.setEnd(t.anchorNode,t.anchorOffset)),o}),e.getSelection=function(e){e=e||window;var t=e[E],n=C(e),r=A?o(e):null;return t?(t.nativeSelection=n,t.docSelection=r,t.refresh(e)):(t=new g(n,r,e),e[E]=t),t},e.getIframeSelection=function(t){return e.getSelection(y.getIframeWindow(t))};var V=g.prototype;if(!x&&B&&w.areHostMethods(I,["removeAllRanges","addRange"])){V.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),s(this)};var q=function(t,n){var o=S.getRangeDocument(n),r=e.createRange(o);r.collapseToPoint(n.endContainer,n.endOffset),t.nativeSelection.addRange(a(r)),t.nativeSelection.extend(n.startContainer,n.startOffset),t.refresh()};V.addRange=L?function(t,n){if(j&&A&&this.docSelection.type==D)h(this,t);else if(n&&M)q(this,t);else{var o;if(k?o=this.rangeCount:(this.removeAllRanges(),o=0),this.nativeSelection.addRange(a(t)),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==o+1){if(e.config.checkSelectionRanges){var i=U(this.nativeSelection,this.rangeCount-1);i&&!S.rangesEqual(i,t)&&(t=new O(i))}this._ranges[this.rangeCount-1]=t,r(this,t,Q(this.nativeSelection)),this.isCollapsed=R(this)}else this.refresh()}}:function(e,t){t&&M?q(this,e):(this.nativeSelection.addRange(a(e)),this.refresh())},V.setRanges=function(e){if(j&&e.length>1)p(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(w.isHostMethod(I,"empty")&&w.isHostMethod(P,"select")&&j&&x))return t.fail("No means of selecting a Range or TextRange was found"),!1;V.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=y.getDocument(this.anchorNode);else if(this.docSelection.type==D){var t=this.docSelection.createRange();t.length&&(e=y.getDocument(t.item(0)).body.createTextRange())}if(e){var n=e.body.createTextRange();n.select(),this.docSelection.empty()}}}catch(o){}s(this)},V.addRange=function(e){this.docSelection.type==D?h(this,e):(O.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,r(this,e,!1))},V.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?p(this,e):t&&this.addRange(e[0])}}V.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new _("INDEX_SIZE_ERR");return this._ranges[e]};var z;if(x)z=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=y.getBody(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==D?l(t):u(n)?d(t,n):s(t)};else if(w.isHostMethod(I,"getRangeAt")&&"number"==typeof I.rangeCount)z=function(t){if(j&&A&&t.docSelection.type==D)l(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,o=t.rangeCount;o>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));r(t,t._ranges[t.rangeCount-1],Q(t.nativeSelection)),t.isCollapsed=R(t)}else s(t)};else{if(!B||typeof I.isCollapsed!=N||typeof P.collapsed!=N||!e.features.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;z=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=U(n,0),e._ranges=[t],e.rangeCount=1,i(e),e.isCollapsed=R(e)):s(e)}}V.refresh=function(e){var t=e?this._ranges.slice(0):null;if(z(this),e){var n=t.length;if(n!=this._ranges.length)return!1;for(;n--;)if(!S.rangesEqual(t[n],this._ranges[n]))return!1;return!0}};var Y=function(e,t){var n=e.getAllRanges(),o=!1;e.removeAllRanges();for(var r=0,i=n.length;i>r;++r)o||t!==n[r]?e.addRange(n[r]):o=!0;e.rangeCount||s(e)};V.removeRange=j?function(e){if(this.docSelection.type==D){for(var t,n=this.docSelection.createRange(),o=f(e),r=y.getDocument(n.item(0)),i=y.getBody(r).createControlRange(),s=!1,a=0,c=n.length;c>a;++a)t=n.item(a),t!==o||s?i.add(n.item(a)):s=!0;i.select(),l(this)}else Y(this,e)}:function(e){Y(this,e)};var Q;!x&&B&&e.features.implementsDomRange?(Q=function(e){var t=!1;return e.anchorNode&&(t=1==y.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t},V.isBackwards=function(){return Q(this)}):Q=V.isBackwards=function(){return!1},V.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},V.collapse=function(t,n){m(this,t);var o=e.createRange(y.getDocument(t));o.collapseToPoint(t,n),this.removeAllRanges(),this.addRange(o),this.isCollapsed=!0},V.collapseToStart=function(){if(!this.rangeCount)throw new _("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},V.collapseToEnd=function(){if(!this.rangeCount)throw new _("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},V.selectAllChildren=function(t){m(this,t);var n=e.createRange(y.getDocument(t));n.selectNodeContents(t),this.removeAllRanges(),this.addRange(n)},V.deleteFromDocument=function(){if(j&&A&&this.docSelection.type==D){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),e.parentNode.removeChild(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();this.removeAllRanges();for(var o=0,r=n.length;r>o;++o)n[o].deleteContents();this.addRange(n[r-1])}},V.getAllRanges=function(){return this._ranges.slice(0)},V.setSingleRange=function(e){this.setRanges([e])},V.containsNode=function(e,t){for(var n=0,o=this._ranges.length;o>n;++n)if(this._ranges[n].containsNode(e,t))return!0;return!1},V.toHtml=function(){var e="";if(this.rangeCount){for(var t=S.getRangeDocument(this._ranges[0]).createElement("div"),n=0,o=this._ranges.length;o>n;++n)t.appendChild(this._ranges[n].cloneContents());e=t.innerHTML}return e},V.getName=function(){return"WrappedSelection"},V.inspect=function(){return v(this)},V.detach=function(){this.win[E]=null,this.win=this.anchorNode=this.focusNode=null},g.inspect=v,e.Selection=g,e.selectionPrototype=V,e.addCreateMissingNativeApiListener(function(t){t.getSelection===void 0&&(t.getSelection=function(){return e.getSelection(this)}),t=null})}),!function(e,t){"function"==typeof define?define(t):"undefined"!=typeof module&&module.exports?module.exports.browser=t():this[e]=t()}("bowser",function(){function e(){return r?{msie:o,version:n.match(/msie (\d+(\.\d+)?);/i)[1]}:i?{webkit:o,chrome:o,version:n.match(/chrome\/(\d+(\.\d+)?)/i)[1]}:s?{webkit:o,phantom:o,version:n.match(/phantomjs\/(\d+(\.\d+)+)/i)[1]}:u?{webkit:o,touchpad:o,version:n.match(/touchpad\/(\d+(\.\d+)?)/i)[1]}:c||f?(t={webkit:o,mobile:o,ios:o,iphone:c,ipad:f},m.test(n)&&(t.version=n.match(m)[1]),t):d?{webkit:o,android:o,mobile:o,version:n.match(m)[1]}:a?{webkit:o,safari:o,version:n.match(m)[1]}:l?{opera:o,version:n.match(m)[1]}:g?(t={gecko:o,mozilla:o,version:n.match(/firefox\/(\d+(\.\d+)?)/i)[1]},h&&(t.firefox=o),t):p?{seamonkey:o,version:n.match(/seamonkey\/(\d+(\.\d+)?)/i)[1]}:void 0}var t,n=navigator.userAgent,o=!0,r=/msie/i.test(n),i=/chrome/i.test(n),s=/phantom/i.test(n),a=/safari/i.test(n)&&!i&&!s,c=/iphone/i.test(n),f=/ipad/i.test(n),u=/touchpad/i.test(n),d=/android/i.test(n),l=/opera/i.test(n),h=/firefox/i.test(n),g=/gecko\//i.test(n),p=/seamonkey\//i.test(n),m=/version\/(\d+(\.\d+)?)/i,v=e();return v.msie&&v.version>=7||v.chrome&&v.version>=10||v.firefox&&v.version>=4||v.safari&&v.version>=5||v.opera&&v.version>=10?v.a=o:v.msie&&7>v.version||v.chrome&&10>v.version||v.firefox&&4>v.version||v.safari&&5>v.version||v.opera&&10>v.version?v.c=o:v.x=o,v}),function(e,t,n,o){"use strict";var r={},i=function(){return n||function(){throw Error("jQuery-like library not yet implemented")}}(),s=function(){return{trimRight:function(e){return e.replace(/\s+$/,"")}}}();(function(){var e=!1;r={add:function(t){return e||(e=!0,u.setup()),i(t).attr("contenteditable",!0),i(t).addClass("-js-editable"),this},remove:function(e){return i(e).removeAttr("contenteditable"),i(e).removeClass("-js-editable"),this},on:function(e,t){return u.addListener(e,t),this},off:function(e,t){return u.removeListener(e,t),this},focus:function(e){return this.on("focus",e)},blur:function(e){return this.on("blur",e)},flow:function(e){return this.on("flow",e)},selection:function(e){return this.on("selection",e)},cursor:function(e){return this.on("cursor",e)},newline:function(e){return this.on("newline",e)},insert:function(e){return this.on("insert",e)},split:function(e){return this.on("split",e)},merge:function(e){return this.on("merge",e)},empty:function(e){return this.on("empty",e)},"switch":function(e){return this.on("switch",e)},move:function(e){return this.on("move",e)},clipboard:function(e){return this.on("clipboard",e)}}})();var a=function(){return{focus:function(){console.log("Default focus behavior")},blur:function(e){console.log("Default blur behavior"),e.innerHTML=c.cleanInternals(e.innerHTML)},flow:function(){console.log("Default flow behavior")},selection:function(e,t){t?console.log("Default selection behavior"):console.log("Default selection empty behavior")},cursor:function(e,t){t?console.log("Default cursor behavior"):console.log("Default cursor empty behavior")},newline:function(e,n){console.log(n),console.log("Default newline behavior");var o=n.isAtTheEnd(),r=t.createElement("br");if(n.insertBefore(r),o){console.log("at the end");var i=t.createTextNode("​");n.insertAfter(i)}else console.log("not at the end");n.update()},insert:function(){console.log("Default insert behavior")},split:function(){console.log("Default split behavior")},merge:function(){console.log("Default merge behavior")},empty:function(){console.log("Default empty behavior")},"switch":function(){console.log("Default switch behavior")},move:function(){console.log("Default move behavior")},clipboard:function(){console.log("Default clipboard behavior")}}}();(function(){r.config={event:{focus:function(e){a.focus(e)},blur:function(e){a.blur(e)},flow:function(e,t){a.flow(e,t)},selection:function(e,t){a.selection(e,t)},cursor:function(e,t){a.cursor(e,t)},newline:function(e,t){a.newline(e,t)},insert:function(e,t){a.insert(e,t)},split:function(e,t,n){a.split(e,t,n)},merge:function(e,t){a.merge(e,t)},empty:function(e){a.empty(e)},"switch":function(e,t){a.switch(e,t)},move:function(e,t,n){a.move(e,t,n)},clipboard:function(e,t,n){a.move(e,t,n)}}}})();var c=function(){return{cleanInternals:function(e){return e.replace(/\u200B/g,"<br />")}}}(),f=function(){var e=function(e,t){this.host=e,this.range=t};return e.prototype=function(){return{isAtTheEnd:function(){return h.isEndOfHost(this.host,this.range.endContainer,this.range.endOffset)},isAtTheBeginning:function(){return!1},insertBefore:function(e){this.range.insertNode(e),this.range.setStartAfter(e),this.range.setEndAfter(e)},insertAfter:function(e){this.range.insertNode(e),this.range.setStartBefore(e),this.range.setEndBefore(e)},update:function(){var e=rangy.getSelection();e.removeAllRanges(),e.addRange(this.range)}}}(),e}(),u=function(){var e={},n=function(e,t){e.on("focus.editable",".-js-editable",function(){t("focus",this)}).on("blur.editable",".-js-editable",function(){t("blur",this)}).on("copy.editable",".-js-editable",function(){console.log("Copy")}).on("cut.editable",".-js-editable",function(){console.log("Cut")}).on("paste.editable",".-js-editable",function(){console.log("Paste")})},s=function(e,t){e.on("keydown.editable",".-js-editable",function(e){l.dispatchKeyEvent(e,this)}),l.on("left",function(){console.log("Left key pressed")}).on("up",function(){console.log("Up key pressed")}).on("right",function(){console.log("Right key pressed")}).on("down",function(){console.log("Down key pressed")}).on("tab",function(){console.log("Tab key pressed")}).on("shiftTab",function(){console.log("Shift+Tab key pressed")}).on("esc",function(){console.log("Esc key pressed")}).on("backspace",function(){console.log("Backspace key pressed")}).on("delete",function(){console.log("Delete key pressed")}).on("enter",function(e){console.log("Enter key pressed"),e.preventDefault(),e.stopPropagation();var n=g.getCursor();if(n.isAtTheEnd())t("insert",this,"end");else if(n.isAtTheBeginning())t("insert",this,"beginning");else{var o,r;t("split",this,o,r)}}).on("shiftEnter",function(e){console.log("Shift+Enter key pressed"),e.preventDefault(),e.stopPropagation();var n=g.getCursor();t("newline",this,n)})},a=function(e,t){var n=!1,o=!1;e.on("selectionchange.editable",function(){o?n=!0:t()}),e.on("mousedown.editable",".-js-editable",function(){o=!0,e.on("mouseup.editableSelection",function(){e.off(".editableSelection"),o=!1,n&&(n=!1,t())})})},c=function(e,t){e.on("mouseup.editableSelection",function(){setTimeout(t,0)}),e.on("keyup.editable",".-js-editable",function(){t()})};return{addListener:function(t,n){e[t]===o&&(e[t]=[]),e[t].unshift(n)},removeListener:function(t,n){var r=e[t];if(r!==o)for(var i=0,s=r.length;s>i;i++)if(r[i]===n){r.splice(i,1);break}},notifyListeners:function(t){var n=e[t];if(n!==o)for(var i=0,s=n.length;s>i&&n[i].apply(r,Array.prototype.slice.call(arguments).splice(1))!==!1;i++);},setup:function(){var o=i(t),f=null;e={};for(f in r.config.event)this.addListener(f,r.config.event[f]);n(o,this.notifyListeners),s(o,this.notifyListeners);var u=g.selectionChanged;d.selectionchange?a(o,u):c(o,u)}}}(),d=function(){var e=t.documentElement.contentEditable!==o,n=function(){return!(bowser.gecko||bowser.opera)}();return{contenteditable:e,selectionchange:n}}();n.fn.editable=function(e){return e===o||e?r.add(this):r.remove(this),this};var l=function(){var e=37,t=38,n=39,r=40,i=9,s=27,a=8,c=46,f=13,u={},d=function(e,t){u[e]===o&&(u[e]=[]),u[e].push(t)},l=function(e,t){var n=u[e];if(n!==o)for(var r=0,i=n.length;i>r&&n[r].apply(t,Array.prototype.slice.call(arguments).splice(2))!==!1;r++);};return{dispatchKeyEvent:function(o,u){switch(o.keyCode){case e:l("left",u,o);break;case n:l("right",u,o);break;case t:l("up",u,o);break;case r:l("down",u,o);break;case i:o.shiftKey?l("shiftTab",u,o):l("tab",u,o);break;case s:l("esc",u,o);break;case a:l("backspace",u,o);break;case c:l("delete",u,o);break;case f:o.shiftKey?l("shiftEnter",u,o):l("enter",u,o)}},on:function(e,t){return d(e,t),this}}}(),h=function(){return{getNodeIndex:function(e){for(var t=0;null!==(e=e.previousSibling);)t+=1;return t},isEmpty:function(e){var t,n,o,r=e.childNodes;for(n=0,o=r.length;o>n;n++){if(t=r[n],3===t.nodeType&&!this.isEmptyTextNode(t))return!1;if(1===t.nodeType)return!1}return!0},isEmptyTextNode:function(e){return 3===e.nodeType&&!e.nodeValue},isEndOfHost:function(e,t,n){if(t===e)return this.isEndOffset(t,n);if(this.isEndOffset(t,n)){var o=t.parentNode,r=this.getNodeIndex(t);return this.isEndOfHost(e,o,r)}return!1},isEndOffset:function(e,t){if(3===e.nodeType){var n=e.nodeValue;return t>=s.trimRight(n).length}return e.childNodes[t]===e.lastChild}}}(),g=function(){var e=function(e,t){this.host=e,this.range=t,this.isAnythingSelected=t!==o,this.cursor=this.isAnythingSelected&&t.collapsed,this.selection=!this.cursor};e.prototype.isDifferentFrom=function(e){var t=this.range,n=e.range;return t&&n?!t.equals(n):t||n?!0:!1};var t,n,r=new e,s=function(){if(t?t.refresh():t=rangy.getSelection(),t.rangeCount){var n=t.getRangeAt(0),o=i(n.commonAncestorContainer).closest(".-js-editable");if(o.length)return new e(o[0],n)}return new e};return{getFreshSelection:function(){var e=s();return e.isAnythingSelected?e.cursor?new f(e.host,e.range):new p(e.host,e.range):o},getCursor:function(){var e=this.getFreshSelection();return e instanceof p&&(e=e.deleteContent()),e},getSelection:function(){return n},selectionChanged:function(){console.log("selection changed");var e=s();if(e.isDifferentFrom(r))if(r=e,r.isAnythingSelected)r.cursor?(n instanceof p&&u.notifyListeners("selection",n.host),n=new f(r.host,r.range),u.notifyListeners("cursor",n.host,n)):(n instanceof f&&u.notifyListeners("cursor",n.host),n=new p(r.host,r.range),u.notifyListeners("selection",n.host,n));else{var t=n;n=o,t instanceof f?u.notifyListeners("cursor",t.host):t instanceof p&&u.notifyListeners("selection",t.host)}}}}(),p=function(){var e=function(e,t){this.host=e,this.range=t};return e.prototype=function(){return{text:function(){return""+this.range},html:function(){return this.range.toHtml()},isAllSelected:function(){},strip:function(){},deleteContent:function(){return this.range.deleteContents(),new f(this.host,this.range)},expand:function(){}}}(),e}();e.Editable=r}(window,document,window.jQuery);